<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <link rel="stylesheet" href="/font-icon/fontawesome-free-5.15.4-web/css/all.min.css"/>
    <link rel="stylesheet" href="/css/user-logged-css/partials/top-bar.css">
    <link rel="stylesheet" href="/css/user-logged-css/settings.css">
</head>
<body>

    <%
        const currentEpochTime = Math.floor(new Date().getTime()/1000);
        const day = 30;
        const nameChangePeriod = 86400 * day;
        const nameChangeAble = (userData.othersData.nameLastChange + nameChangePeriod) < currentEpochTime;

        // how many days left to change name
        if (!nameChangeAble) {
            const seconds = (userData.othersData.nameLastChange + nameChangePeriod) - currentEpochTime;
            if (seconds >= 0) {
                const min = Math.floor(seconds / 60);
                const retailSeconds = Math.floor(seconds % 60);
                const hour = Math.floor(min / 60);
                const retailMins = Math.floor(min % 60);
                const day = Math.floor(hour / 24);
                const retailHours = Math.floor(hour % 24);
                
                if (day < 1) {
                    if (hour < 1) {
                        var nameChangeAbleAfter = `${retailMins} minutes`;
                        if (retailMins < 1) {
                            nameChangeAbleAfter = `${retailSeconds} seconds`;
                        }
                    } else  {
                        nameChangeAbleAfter = `${hour} hours`;
                    }
                } else {
                    nameChangeAbleAfter = `${day} days`;
                }
            } else {
                nameChangeAbleAfter = 0;
            }
        }
    %>


<%- include("../../partials/top-bar.ejs") %>
    <section class="sections">
        <div class="container">

        <% if (uri === undefined) { %>

            <div class="settings-root">
                <a class="feature-path" href="/user/settings/general-information">
                    <i class="fas fa-user-cog"></i>
                    <p>general information</p>
                </a>
                <a class="feature-path" href="/user/settings/security">
                    <i class="fas fa-shield-alt"></i>
                    <p>security <span>and</span> login</p>
                </a>
            </div>

        <% } else if (uri === "general-information") {%>
            <div class="general-information-area">
                <div class="user-property name">
                    <div class="inner">
                        <p class="title">Name</p>
                        <p class="content"><%= userData.firstName+" "+userData.lastName %></p>
                        <button class="edit-btn">Edit</button>
                    </div>
                    <div class="edit-area hide">
                        <div class="msg-for-nm-change<%= !nameChangeAble ? " hide" : "" %>">
                            <span>Once you change your name, you will not be able to change your name for the next 30 days!</span>
                        </div>
                        <div class="wrap">
                            <div class="input-cont">
                                <input id="first-name" type="text" placeholder="First name" value="<%= userData.firstName %>" <%= !nameChangeAble ? "disabled" : "" %> />
                                <div class="fst-nm-msg"></div>
                            </div>
                            <div class="input-cont">
                                <input id="last-name" type="text" placeholder="Last name" value="<%= userData.lastName %>" <%= !nameChangeAble ? "disabled" : "" %> />
                                <div class="lst-nm-msg"></div>
                            </div>
                        </div>
                        <div class="btn-cont <%= !nameChangeAble ? "hide" : "" %>">
                            <button class="update-btn" onclick="generalInfoUpdate_ApiRequest('name')">Change</button>
                        </div>
                        <div class="nm-msg">
                            <%- !nameChangeAble ? `<small class="error-message">You will be able to change your name after ${nameChangeAbleAfter}!</small>` : ""%>
                        </div>
                    </div>
                </div>
                <div class="user-property username">
                    <div class="inner">
                        <p class="title">Username</p>
                        <p class="content"><%= userData.username %></p>
                        <button class="edit-btn" id="username-edit-btn">Edit</button>
                    </div>
                    <div class="edit-area hide">
                        <div class="wrap">
                            <div class="input-cont">
                                <input id="username" type="text" placeholder="Your username" value="<%= userData.username %>" />
                                <div class="usernm-msg"></div>
                            </div>
                        </div>
                        <div class="btn-cont">
                            <button class="update-btn" onclick="generalInfoUpdate_ApiRequest('username')">Change</button>
                        </div>
                    </div>
                </div>
                <div class="user-property email">
                    <div class="inner">
                        <p class="title">Email</p>
                        <p class="content"><%= userData.email %></p>
                        <button class="edit-btn" id="email-edit-btn">Edit</button>
                    </div>
                    <div class="edit-area hide">
                        <div class="wrap">
                            <div class="input-cont">
                                <input id="email" type="text" placeholder="Your email address" value="<%= userData.email %>" />
                                <div class="eml-msg"></div>
                            </div>
                            <div class="input-cont auth-password-cont">
                                <input id="auth-password" type="password" placeholder="Enter your password to change your email address" />
                                <i class="fas fa-eye"></i>
                                <div class="auth-password-msg"></div>
                            </div>
                        </div>
                        <div class="btn-cont">
                            <button class="update-btn" onclick="generalInfoUpdate_ApiRequest('email')">Change</button>
                        </div>
                    </div>
                </div>
            </div>

        <% } else if (uri === "security") {%>
            <div class="security-area">
                <div>Security Area</div>
            </div>

        <% } %>

        </div>
        <div class="floating-alert-notification"></div>
        <div id="load-animation"></div>
    </section>

    
    <script src="/scripts/user-logged-scripts/partials-scripts/top-bar.js"></script>
    <script src="/scripts/user-logged-scripts/settings.js"></script>
</body>
</html>